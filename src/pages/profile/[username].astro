---
import ErrorDisplay from "../../components/ErrorDisplay.astro";
import ProfileHeader from "../../components/profile/ProfileHeader.astro";
import UltContainer from "../../components/ult/UltContainer";
import {apiCall, tryConnection} from "../../helpers/index";
import Layout from "../../layouts/Layout.astro";

const { username: usernameParam } = Astro.params;

const connected = await tryConnection();
const {error, code, data} =
  connected !== true ? connected : await apiCall(`/user/${usernameParam}`);
---

<Layout title={`${usernameParam} - profile`} mainHeader="Profile">
  <>
  {
    !error ? (
      <ProfileHeader user={data} />
      <h3>Last user ults</h3>
      <UltContainer client:load />
      ) : (
        <ErrorDisplay message={data} code={code} />
    )
  }
  </>
</Layout>